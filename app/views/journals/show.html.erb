<%= stylesheet_link_tag 'show', :media => "all" %>

<div class="show-journal-container">
  <div class="show-grid">
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="main-content">
      <div class="journal-detail-card">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <div class="journal-header">
          <h1 class="journal-title">
            <%= @journal.body.present? ? truncate(@journal.body, length: 50) : "Êó•Ë®ò ##{@journal.id}" %>
          </h1>
          
          <!-- „É°„ÇøÊÉÖÂ†± -->
          <div class="journal-meta">
            <div class="meta-item">
              <span class="meta-icon">üë§</span>
              <span><%= @journal.user.email %></span>
            </div>
            
            <% if @journal.visit_date.present? %>
              <div class="meta-item">
                <span class="meta-icon">üìÖ</span>
                <span>Ë®™ÂïèÊó•: <%= @journal.visit_date.strftime('%YÂπ¥%mÊúà%dÊó•') %></span>
              </div>
            <% end %>
            
            <div class="meta-item">
              <span class="meta-icon">üïê</span>
              <span>ÊäïÁ®øÊó•: <%= @journal.created_at.strftime('%YÂπ¥%mÊúà%dÊó•') %></span>
            </div>
          </div>
        </div>

        <!-- ÂçöÁâ©È§®ÊÉÖÂ†± -->
        <% if @museum %>
          <div class="museum-info-card">
            <div class="museum-info-content">
              <div class="museum-info-main">
                <h3 class="museum-section-title">Ë®™Âïè„Åó„ÅüÂçöÁâ©È§®</h3>
                <%= link_to museum_path(@museum), class: "museum-name-link" do %>
                  <p class="museum-name"><%= @museum.name %></p>
                <% end %>
                <div class="museum-details">
                  <p class="museum-detail-item">
                    <span class="detail-icon">üìç</span>
                    <span><%= @museum.full_address %></span>
                  </p>
                  <% if @museum.museum_type.present? %>
                    <p class="museum-detail-item">
                      <span class="detail-icon">üèõÔ∏è</span>
                      <span><%= @museum.museum_type %></span>
                    </p>
                  <% end %>
                </div>
              </div>
              <%= link_to "ÂçöÁâ©È§®„ÅÆË©≥Á¥∞", museum_path(@museum), class: "btn-museum-detail" %>
            </div>
          </div>
        <% end %>

        <!-- Ë©ï‰æ°„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <% if @journal.overall.present? || @journal.rate.present? %>
          <div class="ratings-display">
            <!-- Ê∫ÄË∂≥Â∫¶ -->
            <% if @journal.overall.present? %>
              <div class="rating-item">
                <span class="rating-label">Ê∫ÄË∂≥Â∫¶</span>
                <div class="stars">
                  <% @journal.overall.times do %>
                    <span class="star star-filled">‚òÖ</span>
                  <% end %>
                  <% (5 - @journal.overall).times do %>
                    <span class="star star-empty">‚òÖ</span>
                  <% end %>
                </div>
                <span class="rating-text">
                  <%= case @journal.overall
                      when 5 then "5"
                      when 4 then "4"
                      when 3 then "3"
                      when 2 then "2"
                      when 1 then "1"
                      end %>
                </span>
              </div>
            <% end %>

            <!-- „Åä„Åô„Åô„ÇÅÂ∫¶ -->
            <% if @journal.rate.present? %>
              <div class="rating-item">
                <span class="rating-label">„Åä„Åô„Åô„ÇÅÂ∫¶</span>
                <div class="stars">
                  <% @journal.rate.times do %>
                    <span class="star star-filled">‚òÖ</span>
                  <% end %>
                  <% (5 - @journal.rate).times do %>
                    <span class="star star-empty">‚òÖ</span>
                  <% end %>
                </div>
                <span class="rating-text">
                  <%= case @journal.rate
                      when 5 then "5"
                      when 4 then "4"
                      when 3 then "3"
                      when 2 then "2"
                      when 1 then "1"
                      end %>
                </span>
              </div>
            <% end %>
          </div>
        <% end %>

        <!-- ÁîªÂÉèË°®Á§∫ -->
        <% if @journal.images.attached? && @journal.images.any? %>
          <div class="journal-image-section">
            <% @journal.images.each do |image| %>
              <%= image_tag image, alt: "Journal image", class: "journal-image" %>
            <% end %>
          </div>
        <% end %>        

        <!-- Êú¨Êñá -->
        <% if @journal.body.present? %>
          <div class="journal-body">
            <h3 class="body-title">Êú¨Êñá</h3>
            <div class="body-content">
              <%= simple_format(@journal.body) %>
            </div>
          </div>
        <% end %>

        <!-- „Çø„Ç∞ -->
        <% if @journal.tag_list.present? %>
          <div class="tags-section">
            <h3 class="tags-title">„Çø„Ç∞</h3>
            <div class="tags-list">
              <% 
                # tag_list„ÅåÊñáÂ≠óÂàó„ÅÆÂ†¥Âêà„ÅØÈÖçÂàó„Å´Â§âÊèõ
                tags = @journal.tag_list.is_a?(String) ? @journal.tag_list.split(',').map(&:strip) : @journal.tag_list
                tags.each do |tag|
              %>
                <span class="tag-item">#<%= tag %></span>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- „ÇΩ„Éº„Ç∑„É£„É´„Ç¢„ÇØ„Ç∑„Éß„É≥ -->
        <div class="social-actions">
          <div class="social-stats">
            <span class="stat-item">
              <i class="far fa-heart"></i>
              <span id="likes-count"><%= @journal.likes_count %></span> „ÅÑ„ÅÑ„Å≠
            </span>
            <span class="stat-item">
              <i class="far fa-comment"></i>
              <span id="comments-count"><%= @journal.comments_count %></span> „Ç≥„É°„É≥„Éà
            </span>
          </div>
          
          <div class="action-buttons">
            <div id="like-button-container">
              <%= render 'journal_likes/like_button', journal: @journal %>
            </div>
          </div>
        </div>
        
        <!-- „Ç≥„É°„É≥„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="comments-section">
          <h3 class="comments-title">
            <i class="far fa-comments"></i>
            „Ç≥„É°„É≥„Éà (<span id="comments-count-text"><%= @journal.comments_count %></span>)
          </h3>
          
          <!-- „Ç≥„É°„É≥„ÉàÊäïÁ®ø„Éï„Ç©„Éº„É† -->
          <% if user_signed_in? %>
          <div class="comment-form-container" id="comment-form">
            <%= form_with model: [@journal, JournalComment.new], 
                          html: { class: 'comment-form' }, 
                          data: { turbo: true } do |f| %>
              <div class="comment-input-wrapper">
                <%= f.text_area :body, 
                                rows: 3, 
                                placeholder: '„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ...', 
                                class: 'comment-input' %>
              </div>
              <div class="comment-form-actions">
                <%= f.submit 'ÊäïÁ®ø„Åô„Çã', class: 'btn-comment-submit' %>
              </div>
            <% end %>
          </div>
        
          <% else %>
            <p class="login-prompt">
              „Ç≥„É°„É≥„Éà„Åô„Çã„Å´„ÅØ<%= link_to 'Login', new_user_session_path %>„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </p>
          <% end %>          
          
          <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
          <div id="comments-list" class="comments-list">
            <%= render @journal.journal_comments.order(created_at: :desc) %>
          </div>
        </div>
        
        <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
        <% if @journal.user == current_user || (current_user && current_user.admin?) %>
          <div class="action-buttons">
            <%= link_to edit_journal_path(@journal), class: "btn btn-edit" do %>
              <span class="btn-icon">‚úèÔ∏è</span>
              <span>Á∑®ÈõÜ</span>
            <% end %>
            
            <%= button_to journal_path(@journal), 
                         method: :delete,
                         data: { confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„Åã?' },
                         class: "btn btn-delete" do %>
              <span class="btn-icon">üóëÔ∏è</span>
              <span>ÂâäÈô§</span>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
    <div class="sidebar">
      <!-- „Åì„ÅÆÂçöÁâ©È§®„ÅÆ‰ªñ„ÅÆÊó•Ë®ò -->
      <% if @museum && @related_journals.any? %>
        <div class="sidebar-card">
          <h3 class="sidebar-title">
            <%= truncate(@museum.name, length: 20) %>„ÅÆ‰ªñ„ÅÆÊó•Ë®ò
          </h3>
          <div class="related-journals">
            <% @related_journals.each do |journal| %>
              <%= link_to journal_path(journal), class: "related-journal-item" do %>
                <p class="related-journal-title">
                  <%= truncate(journal.body.presence || "Êó•Ë®ò ##{journal.id}", length: 40) %>
                </p>
                <div class="related-journal-meta">
                  <span class="related-date">
                    <%= journal.visit_date.present? ? journal.visit_date.strftime('%YÂπ¥%mÊúà%dÊó•') : journal.created_at.strftime('%YÂπ¥%mÊúà%dÊó•') %>
                  </span>
                  <% if journal.rate.present? %>
                    <span class="related-rating">
                      <% journal.rate.times do %>‚òÖ<% end %>
                    </span>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Êàª„Çã„É™„É≥„ÇØ -->
      <div class="sidebar-card">
        <%= link_to journals_path, class: "back-link" do %>
          <span class="back-icon">‚Üê</span>
          <span>Êó•Ë®ò‰∏ÄË¶ß„Å´Êàª„Çã</span>
        <% end %>
      </div>
    </div>
  </div>
</div>


# <%= link_to "HOME", journals_path %>
# <div class="journal">
#   <p><%= @journal.body %></p>
#   <p><%= @journal.created_at %></p>
# </div>

# <%= link_to "Á∑®ÈõÜ„Åô„Çã", edit_journal_path(@journal.id) %>